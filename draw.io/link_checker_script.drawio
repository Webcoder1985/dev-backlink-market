<mxfile host="drawio-plugin" modified="2021-12-03T21:23:08.545Z" agent="5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36" etag="YBRLKekwvYKxV4JdERFN" version="14.7.4" type="embed"><diagram id="23iRSUPoRavnBvh4doch" name="Page-1"><mxGraphModel dx="1662" dy="722" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="3" value="Link check script&lt;br&gt;runs every 3h &lt;br&gt;via Cron" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="340" y="10" width="120" height="60" as="geometry"/></mxCell><mxCell id="14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="4" target="13" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="4" value="&lt;u style=&quot;font-weight: bold&quot;&gt;blmkt_links&lt;/u&gt;&lt;br&gt;select * where status=20 AND last_link_live_check &amp;lt; now -24h&lt;br&gt;check if promoted_url is in downloaded&lt;br&gt;html from page_url wit anchor_text" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="20" y="100" width="360" height="70" as="geometry"/></mxCell><mxCell id="7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="5" target="6" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="5" target="8" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="5" value="Link live?" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="354" y="310" width="80" height="80" as="geometry"/></mxCell><mxCell id="6" value="offline_counter=0" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="186" y="320" width="120" height="60" as="geometry"/></mxCell><mxCell id="52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="59" target="51" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="8" target="59"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="8" value="offline_counter +1" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="494" y="320" width="120" height="60" as="geometry"/></mxCell><mxCell id="10" value="no" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="434" y="330" width="40" height="20" as="geometry"/></mxCell><mxCell id="11" value="yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="306" y="330" width="40" height="20" as="geometry"/></mxCell><mxCell id="15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="13" target="5" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="13" value="update blmkt_link&lt;br&gt;last_link_live_check =&amp;nbsp;current timestamp&lt;br&gt;last_http_status_code = http response code" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="260" y="211" width="280" height="70" as="geometry"/></mxCell><mxCell id="19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="16" target="18" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="16" value="if counter=2" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="610" y="520" width="80" height="80" as="geometry"/></mxCell><mxCell id="18" value="send mail to seller_email&lt;br&gt;Downtime min. 6h" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="590" y="635" width="120" height="60" as="geometry"/></mxCell><mxCell id="20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" target="21" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="786" y="600" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="21" target="53"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="21" value="send mail to seller_email&lt;br&gt;Downtime 24h" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="726" y="635" width="120" height="60" as="geometry"/></mxCell><mxCell id="22" value="if counter=3" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="746" y="520" width="80" height="80" as="geometry"/></mxCell><mxCell id="25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="26" target="27" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="26" value="if counter=1" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="470" y="520" width="80" height="80" as="geometry"/></mxCell><mxCell id="27" value="recheck in 6h" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="450" y="635" width="120" height="60" as="geometry"/></mxCell><mxCell id="44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="43" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="400" y="200" as="targetPoint"/></mxGeometry></mxCell><mxCell id="43" value="&lt;u style=&quot;font-weight: bold&quot;&gt;blmkt_links&lt;/u&gt;&amp;nbsp; (recheck)&lt;br&gt;select * where status=20 AND last_link_live_check &lt;b&gt;&amp;lt;&lt;/b&gt; now -6h AND offline_counter=1&lt;br&gt;check if promoted_url is in downloaded&lt;br&gt;html from page_url wit anchor_text" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="400" y="100" width="490" height="70" as="geometry"/></mxCell><mxCell id="45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" target="46" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="918" y="600" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="46" target="55"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="46" value="send mail to seller_email&lt;br&gt;Downtime 48h" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="858" y="635" width="120" height="60" as="geometry"/></mxCell><mxCell id="47" value="if counter=4" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="878" y="520" width="80" height="80" as="geometry"/></mxCell><mxCell id="49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" target="50" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="1050" y="600" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="58" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="50" target="56"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="50" value="send mail to seller_email&lt;br&gt;Downtime 72h" style="whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="990" y="635" width="120" height="60" as="geometry"/></mxCell><mxCell id="51" value="if counter=5" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="1010" y="520" width="80" height="80" as="geometry"/></mxCell><mxCell id="53" value="Admin notification" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="726" y="720" width="120" height="60" as="geometry"/></mxCell><mxCell id="55" value="Admin notification" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="858" y="720" width="120" height="60" as="geometry"/></mxCell><mxCell id="56" value="Admin notification" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="990" y="720" width="120" height="60" as="geometry"/></mxCell><mxCell id="65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="59" target="22"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="59" target="16"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="59" target="26"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="81" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="59" target="79"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="87" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="59" target="85"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="59" value="If http_status_code =200&lt;br&gt;Means domain is live but link is not added&lt;br&gt;try to add link&lt;br&gt;&lt;br&gt;If http_status_code =404&lt;br&gt;blog post deleted? check domain http_status_code&lt;br&gt;&lt;br&gt;If http_status_code =301/302&lt;br&gt;redirect, investigate why&lt;br&gt;&lt;br&gt;use these information for seller email" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="666" y="257.5" width="240" height="185" as="geometry"/></mxCell><mxCell id="75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.16;exitY=0.55;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="68" target="59"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="68" value="what if domain is down &lt;br&gt;and seller has 100 active links, &lt;br&gt;we can not sent 100 mails" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="938" y="273" width="230" height="140" as="geometry"/></mxCell><mxCell id="76" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" target="78" parent="1"><mxGeometry relative="1" as="geometry"><mxPoint x="1190" y="600" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="77" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="78" target="80" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="78" value="send mail to seller_email&lt;br&gt;Downtime 96h" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="1130" y="635" width="120" height="60" as="geometry"/></mxCell><mxCell id="79" value="if counter=6" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="1150" y="520" width="80" height="80" as="geometry"/></mxCell><mxCell id="80" value="Admin notification" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="1130" y="720" width="120" height="60" as="geometry"/></mxCell><mxCell id="82" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" target="84" parent="1"><mxGeometry relative="1" as="geometry"><mxPoint x="1330" y="600" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="83" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" source="84" target="86" parent="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="84" value="initiate refund&lt;br&gt;mail seller&lt;br&gt;Downtime 120h" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="1270" y="635" width="120" height="60" as="geometry"/></mxCell><mxCell id="85" value="if counter=7" style="rhombus;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="1290" y="520" width="80" height="80" as="geometry"/></mxCell><mxCell id="86" value="Admin notification" style="whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="1270" y="720" width="120" height="60" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>